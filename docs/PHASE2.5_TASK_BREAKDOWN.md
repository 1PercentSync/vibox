# Phase 2.5 Frontend-Backend Integration Task Breakdown

> **ç›®æ ‡**: å°†Reactå‰ç«¯æ„å»ºäº§ç‰©åµŒå…¥åˆ°Goåç«¯äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼Œå®ç°å•æ–‡ä»¶éƒ¨ç½²
>
> **æ—¶é—´**: 1-2å¤©
>
> **çŠ¶æ€**: ğŸ“ å½“å‰é˜¶æ®µ

---

## ç›®å½•

1. [æ¦‚è¿°](#æ¦‚è¿°)
2. [æ¨¡å—ä¾èµ–å…³ç³»](#æ¨¡å—ä¾èµ–å…³ç³»)
3. [ä»»åŠ¡æ¨¡å—](#ä»»åŠ¡æ¨¡å—)
4. [éªŒæ”¶æ ‡å‡†](#éªŒæ”¶æ ‡å‡†)
5. [æµ‹è¯•æ¸…å•](#æµ‹è¯•æ¸…å•)
6. [å›æ»šè®¡åˆ’](#å›æ»šè®¡åˆ’)

---

## æ¦‚è¿°

### Phase 2.5 ç›®æ ‡

å°†ViBoxä»**åŒè¿›ç¨‹åº”ç”¨**ï¼ˆGoåç«¯ + Viteå¼€å‘æœåŠ¡å™¨ï¼‰è½¬æ¢ä¸º**å•ä¸€å¯æ‰§è¡Œæ–‡ä»¶**ï¼ŒåŒæ—¶åŒ…å«åç«¯å’Œå‰ç«¯ã€‚

**Phase 2.5ä¹‹å‰**:
```
ç»ˆç«¯1: go run ./cmd/server    (åç«¯ :3000)
ç»ˆç«¯2: npm run dev             (å‰ç«¯ :5173)
æµè§ˆå™¨: http://localhost:5173   (é€šè¿‡Viteä»£ç†è®¿é—®)
```

**Phase 2.5ä¹‹å**:
```
ç»ˆç«¯:   ./vibox                 (å•ä¸€äºŒè¿›åˆ¶æ–‡ä»¶)
æµè§ˆå™¨: http://localhost:3000   (ç›´æ¥è®¿é—®)
```

### æ ¸å¿ƒä¼˜åŠ¿

1. **å•æ–‡ä»¶éƒ¨ç½²** - ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶åŒ…å«æ‰€æœ‰å†…å®¹
2. **ç®€åŒ–è®¾ç½®** - ç”Ÿäº§ç¯å¢ƒæ— éœ€Node.js
3. **ç”Ÿäº§å°±ç»ª** - ä¼˜åŒ–çš„é™æ€èµ„æºæœåŠ¡å’ŒSPAè·¯ç”±æ”¯æŒ
4. **å¼€å‘å‹å¥½** - ä¿æŒç‹¬ç«‹å¼€å‘æ¨¡å¼å’ŒHMR

### åµŒå…¥å†…å®¹

- `frontend/dist/index.html` - å…¥å£æ–‡ä»¶
- `frontend/dist/assets/*.js` - JavaScriptåŒ… (~250KB gzipped)
- `frontend/dist/assets/*.css` - æ ·å¼è¡¨ (~7KB gzipped)
- æ‰€æœ‰vendor chunks (React, xterm.jsç­‰)

### æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  vibox (å•ä¸€å¯æ‰§è¡Œæ–‡ä»¶)                  â”‚
â”‚                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  Gin Router                        â”‚â”‚
â”‚  â”‚                                    â”‚â”‚
â”‚  â”‚  ä¼˜å…ˆçº§é¡ºåº:                       â”‚â”‚
â”‚  â”‚  1. /api/*      â†’ APIå¤„ç†å™¨       â”‚â”‚
â”‚  â”‚  2. /ws/*       â†’ WebSocket       â”‚â”‚
â”‚  â”‚  3. /forward/*  â†’ ç«¯å£ä»£ç†        â”‚â”‚
â”‚  â”‚  4. /health     â†’ å¥åº·æ£€æŸ¥        â”‚â”‚
â”‚  â”‚  5. é™æ€æ–‡ä»¶     â†’ å¦‚æœå­˜åœ¨        â”‚â”‚
â”‚  â”‚  6. /index.html â†’ SPAå›é€€         â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚                                         â”‚
â”‚  [åµŒå…¥çš„å‰ç«¯é™æ€æ–‡ä»¶]                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ¨¡å—ä¾èµ–å…³ç³»

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ¨¡å—1: å‰ç«¯æ„å»ºéªŒè¯                     â”‚
â”‚  (å‰ç½®æ¡ä»¶)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ¨¡å—2: é™æ€æ–‡ä»¶åµŒå…¥                     â”‚
â”‚  - åˆ›å»º internal/static/embed.go        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ¨¡å—3: è·¯ç”±å™¨æ›´æ–°                       â”‚
â”‚  - æ·»åŠ é™æ€æ–‡ä»¶æœåŠ¡                      â”‚
â”‚  - å®ç°SPAå›é€€                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ¨¡å—4: æ„å»ºå’Œé›†æˆæµ‹è¯•                   â”‚
â”‚  - æµ‹è¯•ç”Ÿäº§æ„å»º                          â”‚
â”‚  - éªŒè¯æ‰€æœ‰è·¯ç”±                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä»»åŠ¡æ¨¡å—

### æ¨¡å—1: å‰ç«¯æ„å»ºéªŒè¯

**è´Ÿè´£äºº**: å¼€å‘è€…
**é¢„è®¡æ—¶é—´**: 30åˆ†é’Ÿ
**ä¼˜å…ˆçº§**: ğŸ”´ å…³é”®ï¼ˆå¿…é¡»é¦–å…ˆå®Œæˆï¼‰

#### ç›®çš„

ç¡®ä¿å‰ç«¯æ­£ç¡®æ„å»ºå¹¶è¾“å‡ºåˆ°é¢„æœŸä½ç½®ï¼Œç»“æ„æ­£ç¡®ã€‚

#### ä»»åŠ¡æ¸…å•

- [ ] éªŒè¯å‰ç«¯æ„å»ºé…ç½®
  - [ ] æ£€æŸ¥ `vite.config.ts` è¾“å‡ºç›®å½•æ˜¯ `dist`
  - [ ] éªŒè¯ `assetsDir` è®¾ç½®ä¸º `assets`
  - [ ] æ£€æŸ¥æ‰‹åŠ¨chunksé…ç½®ï¼ˆvendoråˆ†å‰²ï¼‰
  - [ ] ç¡®ä¿ç”Ÿäº§ç¯å¢ƒç¦ç”¨sourcemap
- [ ] æµ‹è¯•å‰ç«¯æ„å»º
  - [ ] è¿è¡Œ `cd frontend && npm run build`
  - [ ] éªŒè¯ `frontend/dist/` ç›®å½•å·²åˆ›å»º
  - [ ] éªŒè¯ `frontend/dist/index.html` å­˜åœ¨
  - [ ] éªŒè¯ `frontend/dist/assets/` åŒ…å«JS/CSSæ–‡ä»¶
  - [ ] æ£€æŸ¥æ€»æ„å»ºå¤§å° (~250KB gzipped)
- [ ] éªŒè¯æ„å»ºè¾“å‡ºç»“æ„
  ```
  frontend/dist/
  â”œâ”€â”€ index.html
  â””â”€â”€ assets/
      â”œâ”€â”€ index-[hash].js
      â”œâ”€â”€ react-vendor-[hash].js
      â”œâ”€â”€ xterm-vendor-[hash].js
      â”œâ”€â”€ ui-vendor-[hash].js
      â”œâ”€â”€ WorkspacesPage-[hash].js
      â”œâ”€â”€ WorkspaceDetailPage-[hash].js
      â””â”€â”€ index-[hash].css
  ```

#### é¢„æœŸViteé…ç½®

```typescript
// frontend/vite.config.ts
export default defineConfig({
  build: {
    outDir: 'dist',
    assetsDir: 'assets',
    sourcemap: false,
    rollupOptions: {
      output: {
        manualChunks: {
          'react-vendor': ['react', 'react-dom', 'react-router-dom'],
          'xterm-vendor': ['@xterm/xterm', '@xterm/addon-fit', '@xterm/addon-web-links'],
          'ui-vendor': ['jotai', 'axios'],
        },
      },
    },
  },
})
```

#### éªŒæ”¶æ ‡å‡†

- [ ] æ„å»ºå®Œæˆæ— é”™è¯¯
- [ ] `frontend/dist/` ç›®å½•ç»“æ„æ­£ç¡®
- [ ] `index.html` åŒ…å«æ­£ç¡®çš„èµ„æºå¼•ç”¨
- [ ] æ€»gzipå¤§å°çº¦250KB
- [ ] æ‰€æœ‰vendor chunksæ­£ç¡®åˆ†å‰²

---

### æ¨¡å—2: é™æ€æ–‡ä»¶åµŒå…¥

**è´Ÿè´£äºº**: å¼€å‘è€…
**é¢„è®¡æ—¶é—´**: 30åˆ†é’Ÿ
**ä¼˜å…ˆçº§**: ğŸ”´ å…³é”®
**ä¾èµ–**: æ¨¡å—1

#### ç›®çš„

åˆ›å»ºGoåŒ…ï¼Œä½¿ç”¨Go 1.16+ embedåŠŸèƒ½å°†å‰ç«¯æ„å»ºè¾“å‡ºåµŒå…¥åˆ°äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ã€‚

#### ä»»åŠ¡æ¸…å•

- [ ] åˆ›å»ºstaticåŒ…ç›®å½•
  - [ ] åˆ›å»º `internal/static/` ç›®å½•
- [ ] åˆ›å»ºembed.goæ–‡ä»¶
  - [ ] åˆ›å»º `internal/static/embed.go`
  - [ ] ä¸º `dist` ç›®å½•æ·»åŠ embedæŒ‡ä»¤
  - [ ] æ·»åŠ åŒ…æ–‡æ¡£
- [ ] å°†å‰ç«¯æ„å»ºå¤åˆ¶åˆ°åµŒå…¥ä½ç½®
  - [ ] æ–¹æ¡ˆA: å¤åˆ¶ `frontend/dist/` åˆ° `internal/static/dist/` (ç®€å•)
  - [ ] æ–¹æ¡ˆB: ä½¿ç”¨ç›¸å¯¹è·¯å¾„ `../../frontend/dist` (ä¿æŒå•ä¸€æ¥æº)
- [ ] æ›´æ–°.gitignore
  - [ ] å¦‚ä½¿ç”¨æ–¹æ¡ˆAï¼Œæ·»åŠ  `internal/static/dist/`
  - [ ] ç¡®ä¿ `frontend/dist/` å·²è¢«å¿½ç•¥

#### å®ç°

**æ–‡ä»¶: `internal/static/embed.go`**

```go
package static

import "embed"

// StaticFiles embeds the frontend build output.
// This uses Go 1.16+ embed feature to include static files in the binary.
// The frontend must be built first using: cd frontend && npm run build
//
// Directory structure:
//   dist/
//   â”œâ”€â”€ index.html
//   â””â”€â”€ assets/
//       â”œâ”€â”€ *.js
//       â””â”€â”€ *.css
//
//go:embed dist
var StaticFiles embed.FS
```

#### æ„å»ºè„šæœ¬é€‰é¡¹

**æ–¹æ¡ˆA: å¤åˆ¶åˆ°internal/static/dist/ (æ¨è)**

ä¼˜åŠ¿:
- å…³æ³¨ç‚¹æ¸…æ™°åˆ†ç¦»
- æ›´ç®€å•çš„embedè·¯å¾„
- è·¨å¹³å°å¯é 

```bash
# build.sh
#!/bin/bash
set -e

echo "Building frontend..."
cd frontend
npm run build
cd ..

echo "Copying frontend build to static directory..."
rm -rf internal/static/dist
cp -r frontend/dist internal/static/

echo "Building backend..."
go build -o vibox ./cmd/server

echo "Build complete: ./vibox"
```

#### éªŒæ”¶æ ‡å‡†

- [ ] `internal/static/embed.go` æ–‡ä»¶å·²åˆ›å»º
- [ ] EmbedæŒ‡ä»¤æ­£ç¡®æŒ‡å‘distç›®å½•
- [ ] é™æ€æ–‡ä»¶å¯é€šè¿‡ `StaticFiles` å˜é‡è®¿é—®
- [ ] æ„å»ºå®Œæˆæ— é”™è¯¯
- [ ] äºŒè¿›åˆ¶æ–‡ä»¶å¤§å°å¢åŠ çº¦250KBï¼ˆå‰ç«¯èµ„æºï¼‰

---

### æ¨¡å—3: è·¯ç”±å™¨æ›´æ–°

**è´Ÿè´£äºº**: å¼€å‘è€…
**é¢„è®¡æ—¶é—´**: 1å°æ—¶
**ä¼˜å…ˆçº§**: ğŸ”´ å…³é”®
**ä¾èµ–**: æ¨¡å—2

#### ç›®çš„

æ›´æ–°Ginè·¯ç”±å™¨ä»¥æä¾›åµŒå…¥çš„é™æ€æ–‡ä»¶æœåŠ¡ï¼Œå¹¶æ”¯æŒæ­£ç¡®çš„SPAè·¯ç”±å›é€€ã€‚

#### ä»»åŠ¡æ¸…å•

- [ ] æ›´æ–°router.goå¯¼å…¥
  - [ ] æ·»åŠ  `io/fs` åŒ…
  - [ ] æ·»åŠ  `net/http` åŒ…
  - [ ] å¯¼å…¥ `internal/static` åŒ…
- [ ] å®ç°é™æ€æ–‡ä»¶ä¸­é—´ä»¶
  - [ ] ä¸º `dist/` ç›®å½•åˆ›å»ºå­æ–‡ä»¶ç³»ç»Ÿ
  - [ ] æ·»åŠ API/WS/forward/healthè·¯ç”±è·³è¿‡é€»è¾‘
  - [ ] å®ç°é™æ€æ–‡ä»¶æœåŠ¡
  - [ ] å®ç°SPAå›é€€ï¼ˆæä¾›index.htmlï¼‰
- [ ] æµ‹è¯•è·¯ç”±ä¼˜å…ˆçº§
  - [ ] APIè·¯ç”±å·¥ä½œ (`/api/*`)
  - [ ] WebSocketè·¯ç”±å·¥ä½œ (`/ws/*`)
  - [ ] ç«¯å£è½¬å‘å·¥ä½œ (`/forward/*`)
  - [ ] å¥åº·æ£€æŸ¥å·¥ä½œ (`/health`)
  - [ ] é™æ€æ–‡ä»¶åŠ è½½ (`/assets/*.js`, `/assets/*.css`)
  - [ ] SPAè·¯ç”±å›é€€åˆ°index.html (`/workspace/xxx`)

#### å®ç°

**æ–‡ä»¶: `internal/api/router.go`**

```go
package api

import (
    "io/fs"
    "net/http"
    "strings"

    "github.com/gin-gonic/gin"
    "github.com/1PercentSync/vibox/internal/static"
    "github.com/1PercentSync/vibox/internal/api/handler"
    "github.com/1PercentSync/vibox/internal/api/middleware"
    "github.com/1PercentSync/vibox/internal/config"
)

func SetupRouter(
    cfg *config.Config,
    workspaceHandler *handler.WorkspaceHandler,
    terminalHandler *handler.TerminalHandler,
    proxyHandler *handler.ProxyHandler,
) *gin.Engine {
    if cfg.Environment == "production" {
        gin.SetMode(gin.ReleaseMode)
    }

    router := gin.Default()

    // Add CORS middleware if needed
    router.Use(middleware.CORS())

    // Health check (no auth)
    router.GET("/health", func(c *gin.Context) {
        c.JSON(http.StatusOK, gin.H{"status": "ok"})
    })

    // Authentication routes (no auth required)
    auth := router.Group("/api/auth")
    {
        auth.POST("/login", handler.Login(cfg))
        auth.POST("/logout", handler.Logout)
    }

    // API routes (auth required)
    api := router.Group("/api")
    api.Use(middleware.AuthMiddleware(cfg.APIToken))
    {
        api.POST("/workspaces", workspaceHandler.Create)
        api.GET("/workspaces", workspaceHandler.List)
        api.GET("/workspaces/:id", workspaceHandler.Get)
        api.DELETE("/workspaces/:id", workspaceHandler.Delete)
        api.PUT("/workspaces/:id/ports", workspaceHandler.UpdatePorts)
        api.POST("/workspaces/:id/reset", workspaceHandler.ResetWorkspace)
    }

    // WebSocket routes (auth required via query param or cookie)
    ws := router.Group("/ws")
    ws.Use(middleware.WSAuthMiddleware(cfg.APIToken))
    {
        ws.GET("/terminal/:id", terminalHandler.HandleTerminal)
    }

    // Port forwarding (auth required)
    forward := router.Group("/forward")
    forward.Use(middleware.ProxyAuthMiddleware(cfg.APIToken))
    {
        forward.Any("/:id/:port/*path", proxyHandler.HandleProxy)
    }

    // Static file serving + SPA fallback
    // This must be last to not override API routes
    staticFS, err := fs.Sub(static.StaticFiles, "dist")
    if err != nil {
        panic("Failed to create sub-filesystem: " + err.Error())
    }

    router.Use(func(c *gin.Context) {
        path := c.Request.URL.Path

        // Skip API, WebSocket, forward, and health routes
        if strings.HasPrefix(path, "/api") ||
           strings.HasPrefix(path, "/ws") ||
           strings.HasPrefix(path, "/forward") ||
           path == "/health" {
            c.Next()
            return
        }

        // Try to serve static file
        if _, err := staticFS.Open(strings.TrimPrefix(path, "/")); err == nil {
            c.FileFromFS(path, http.FS(staticFS))
            c.Abort()
            return
        }

        // SPA fallback: serve index.html for all unmatched routes
        c.FileFromFS("/index.html", http.FS(staticFS))
        c.Abort()
    })

    return router
}
```

#### è·¯ç”±ä¼˜å…ˆçº§é€»è¾‘

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ä¼ å…¥è¯·æ±‚                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ è·¯å¾„å¼€å¤´æ˜¯      â”‚
     â”‚ /api, /ws,      â”‚â”€â”€æ˜¯â”€â”€â–º æ‰§è¡Œå¤„ç†å™¨
     â”‚ /forward,       â”‚
     â”‚ æˆ–ç­‰äº          â”‚
     â”‚ /health?        â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚å¦
              â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ é™æ€æ–‡ä»¶        â”‚
     â”‚ å­˜åœ¨äº          â”‚â”€â”€æ˜¯â”€â”€â–º æä¾›æ–‡ä»¶
     â”‚ dist/?          â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚å¦
              â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚ æä¾›            â”‚
     â”‚ index.html      â”‚
     â”‚ (SPAå›é€€)       â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### æµ‹è¯•è·¯ç”±ä¼˜å…ˆçº§

```bash
# 1. APIè·¯ç”±åº”è¯¥å·¥ä½œ
curl http://localhost:3000/api/workspaces
# åº”è¿”å›401ï¼ˆæ— cookieï¼‰æˆ–å·¥ä½œç©ºé—´åˆ—è¡¨

# 2. é™æ€æ–‡ä»¶åº”è¯¥åŠ è½½
curl http://localhost:3000/assets/index-abc123.js
# åº”è¿”å›JavaScriptä»£ç 

# 3. SPAè·¯ç”±åº”è¿”å›index.html
curl http://localhost:3000/workspace/ws-123
# åº”è¿”å›index.htmlå†…å®¹ï¼ˆHTMLï¼‰

# 4. æ ¹è·¯å¾„åº”è¿”å›index.html
curl http://localhost:3000/
# åº”è¿”å›index.htmlå†…å®¹

# 5. å¥åº·æ£€æŸ¥åº”è¯¥å·¥ä½œ
curl http://localhost:3000/health
# åº”è¿”å› {"status":"ok"}
```

#### éªŒæ”¶æ ‡å‡†

- [ ] æ‰€æœ‰APIè·¯ç”±åƒä¹‹å‰ä¸€æ ·å·¥ä½œ
- [ ] WebSocketè¿æ¥å·¥ä½œ
- [ ] ç«¯å£è½¬å‘å·¥ä½œ
- [ ] é™æ€æ–‡ä»¶ï¼ˆJS/CSSï¼‰æ­£ç¡®åŠ è½½
- [ ] æ ¹è·¯å¾„ `/` æä¾›index.html
- [ ] æœªçŸ¥è·¯å¾„æä¾›index.htmlï¼ˆSPAè·¯ç”±ï¼‰
- [ ] æœ‰æ•ˆSPAè·¯ç”±æ— 404é”™è¯¯
- [ ] é™æ€æ–‡ä»¶MIMEç±»å‹æ­£ç¡®

---

### æ¨¡å—4: æ„å»ºå’Œé›†æˆæµ‹è¯•

**è´Ÿè´£äºº**: å¼€å‘è€…
**é¢„è®¡æ—¶é—´**: 1å°æ—¶
**ä¼˜å…ˆçº§**: ğŸŸ¡ é«˜
**ä¾èµ–**: æ¨¡å—3

#### ç›®çš„

æ„å»ºæœ€ç»ˆäºŒè¿›åˆ¶æ–‡ä»¶å¹¶è¿›è¡Œå…¨é¢çš„é›†æˆæµ‹è¯•ï¼Œç¡®ä¿æ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œã€‚

#### ä»»åŠ¡æ¸…å•

##### æ„å»ºæµç¨‹
- [ ] åˆ›å»ºæ„å»ºè„šæœ¬
  - [ ] æ„å»ºå‰ç«¯: `cd frontend && npm run build`
  - [ ] å¤åˆ¶åˆ°staticç›®å½•ï¼ˆå¦‚ä½¿ç”¨æ–¹æ¡ˆAï¼‰
  - [ ] æ„å»ºåç«¯: `go build -o vibox ./cmd/server`
- [ ] æµ‹è¯•æ„å»ºè„šæœ¬
  - [ ] è¿è¡Œæ„å»ºè„šæœ¬
  - [ ] éªŒè¯äºŒè¿›åˆ¶æ–‡ä»¶å·²åˆ›å»º: `./vibox` æˆ– `vibox.exe`
  - [ ] æ£€æŸ¥äºŒè¿›åˆ¶æ–‡ä»¶å¤§å° (~15-20MB)
- [ ] æµ‹è¯•äºŒè¿›åˆ¶æ–‡ä»¶æ‰§è¡Œ
  - [ ] è®¾ç½®API_TOKENç¯å¢ƒå˜é‡
  - [ ] è¿è¡Œ `./vibox`
  - [ ] éªŒè¯æœåŠ¡å™¨åœ¨:3000å¯åŠ¨
  - [ ] æ£€æŸ¥æ§åˆ¶å°é”™è¯¯

##### é›†æˆæµ‹è¯•
- [ ] é™æ€æ–‡ä»¶æœåŠ¡
  - [ ] åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ http://localhost:3000
  - [ ] éªŒè¯ç™»å½•é¡µé¢åŠ è½½
  - [ ] æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°404é”™è¯¯
  - [ ] éªŒè¯CSSæ ·å¼æ­£ç¡®åŠ è½½
  - [ ] éªŒè¯JavaScriptæ— é”™è¯¯åŠ è½½
- [ ] è®¤è¯
  - [ ] ä½¿ç”¨API tokenç™»å½•
  - [ ] éªŒè¯cookieå·²è®¾ç½®
  - [ ] éªŒè¯é‡å®šå‘åˆ°å·¥ä½œç©ºé—´é¡µé¢
- [ ] APIåŠŸèƒ½
  - [ ] åˆ›å»ºå·¥ä½œç©ºé—´ï¼ˆå¸¦ç«¯å£ï¼‰
  - [ ] åˆ—å‡ºå·¥ä½œç©ºé—´
  - [ ] æŸ¥çœ‹å·¥ä½œç©ºé—´è¯¦æƒ…
  - [ ] æ›´æ–°ç«¯å£
  - [ ] é‡ç½®å·¥ä½œç©ºé—´
  - [ ] åˆ é™¤å·¥ä½œç©ºé—´
- [ ] WebSocketç»ˆç«¯
  - [ ] æ‰“å¼€å·¥ä½œç©ºé—´ç»ˆç«¯
  - [ ] éªŒè¯WebSocketè¿æ¥
  - [ ] è¾“å…¥å‘½ä»¤å¹¶æŸ¥çœ‹è¾“å‡º
  - [ ] æµ‹è¯•è°ƒæ•´å¤§å°
  - [ ] æµ‹è¯•é‡è¿
- [ ] ç«¯å£è½¬å‘
  - [ ] é€šè¿‡ `/forward/:id/:port/` è®¿é—®ç«¯å£
  - [ ] éªŒè¯è®¤è¯å·¥ä½œ
  - [ ] æµ‹è¯•ç«¯å£å¿«é€Ÿè®¿é—®æŒ‰é’®
- [ ] SPAè·¯ç”±
  - [ ] åœ¨é¡µé¢é—´å¯¼èˆª
  - [ ] åœ¨å·¥ä½œç©ºé—´è¯¦æƒ…é¡µåˆ·æ–°é¡µé¢
  - [ ] éªŒè¯æ— 404é”™è¯¯
  - [ ] æµ‹è¯•æµè§ˆå™¨åé€€/å‰è¿›æŒ‰é’®

##### æ€§èƒ½æµ‹è¯•
- [ ] æµ‹é‡æ€§èƒ½æŒ‡æ ‡
  - [ ] æœåŠ¡å™¨å¯åŠ¨æ—¶é—´ (<2ç§’)
  - [ ] åˆå§‹é¡µé¢åŠ è½½æ—¶é—´ (<1ç§’)
  - [ ] äºŒè¿›åˆ¶æ–‡ä»¶å¤§å° (<25MB)
  - [ ] å†…å­˜ä½¿ç”¨ (<50MBç©ºé—²)
- [ ] ä½¿ç”¨å¤šä¸ªå·¥ä½œç©ºé—´æµ‹è¯•
  - [ ] åˆ›å»º5-10ä¸ªå·¥ä½œç©ºé—´
  - [ ] æ£€æŸ¥å†…å­˜ä½¿ç”¨
  - [ ] éªŒè¯æ— æ€§èƒ½ä¸‹é™

#### æ„å»ºè„šæœ¬ç¤ºä¾‹

```bash
#!/bin/bash
# build.sh - ViBoxæ„å»ºè„šæœ¬

set -e

echo "================================"
echo "Building ViBox"
echo "================================"

# æ­¥éª¤1: æ„å»ºå‰ç«¯
echo ""
echo "Step 1/3: Building frontend..."
cd frontend
npm run build
cd ..
echo "âœ“ Frontend build complete"

# æ­¥éª¤2: å¤åˆ¶å‰ç«¯åˆ°staticç›®å½•
echo ""
echo "Step 2/3: Copying frontend to static directory..."
rm -rf internal/static/dist
mkdir -p internal/static
cp -r frontend/dist internal/static/
echo "âœ“ Frontend copied to internal/static/dist"

# æ­¥éª¤3: æ„å»ºåç«¯
echo ""
echo "Step 3/3: Building backend..."
go build -o vibox ./cmd/server
echo "âœ“ Backend build complete"

# æ€»ç»“
echo ""
echo "================================"
echo "Build Summary"
echo "================================"
BINARY_SIZE=$(ls -lh vibox | awk '{print $5}')
echo "Binary: ./vibox ($BINARY_SIZE)"
echo ""
echo "To run:"
echo "  export API_TOKEN=your-secret-token"
echo "  ./vibox"
echo ""
echo "Then open: http://localhost:3000"
echo "================================"
```

ä½¿å…¶å¯æ‰§è¡Œ:
```bash
chmod +x build.sh
```

#### éªŒæ”¶æ ‡å‡†

- [ ] äºŒè¿›åˆ¶æ–‡ä»¶åœ¨æ‰€æœ‰å¹³å°ä¸ŠæˆåŠŸæ„å»º
- [ ] äºŒè¿›åˆ¶æ–‡ä»¶å¤§å°å°äº25MB
- [ ] æœåŠ¡å™¨å¯åŠ¨æ— é”™è¯¯
- [ ] æ‰€æœ‰å‰ç«¯é¡µé¢æ­£ç¡®åŠ è½½
- [ ] æµè§ˆå™¨æ§åˆ¶å°æ— 404é”™è¯¯
- [ ] è®¤è¯å·¥ä½œ
- [ ] æ‰€æœ‰APIç«¯ç‚¹å·¥ä½œ
- [ ] WebSocketç»ˆç«¯å·¥ä½œ
- [ ] ç«¯å£è½¬å‘å·¥ä½œ
- [ ] SPAè·¯ç”±æ­£ç¡®å·¥ä½œ
- [ ] æ€§èƒ½æŒ‡æ ‡è¾¾åˆ°ç›®æ ‡
- [ ] é›†æˆæµ‹è¯•é€šè¿‡

---

## éªŒæ”¶æ ‡å‡†

å½“æ»¡è¶³ä»¥ä¸‹æ‰€æœ‰æ ‡å‡†æ—¶ï¼ŒPhase 2.5å®Œæˆ:

### åŠŸèƒ½è¦æ±‚

- [ ] **å•äºŒè¿›åˆ¶éƒ¨ç½²**
  - [ ] å‰ç«¯æ„å»ºè¾“å‡ºåµŒå…¥äºŒè¿›åˆ¶æ–‡ä»¶
  - [ ] äºŒè¿›åˆ¶æ–‡ä»¶åŒ…å«æ‰€æœ‰å‰ç«¯èµ„æº
  - [ ] æ— éœ€å•ç‹¬çš„å‰ç«¯æœåŠ¡å™¨

- [ ] **é™æ€æ–‡ä»¶æœåŠ¡**
  - [ ] æ ¹è·¯å¾„ `/` æä¾›index.html
  - [ ] é™æ€èµ„æºï¼ˆJS/CSSï¼‰æ­£ç¡®åŠ è½½
  - [ ] æä¾›æ­£ç¡®çš„MIMEç±»å‹

- [ ] **SPAè·¯ç”±**
  - [ ] æ‰€æœ‰å‰ç«¯è·¯ç”±å·¥ä½œ (/, /workspace/:id, /settings)
  - [ ] ç›´æ¥URLè®¿é—®å·¥ä½œ
  - [ ] æµè§ˆå™¨åˆ·æ–°ä¿ç•™è·¯ç”±
  - [ ] æœ‰æ•ˆSPAè·¯ç”±æ— 404é”™è¯¯

- [ ] **APIé›†æˆ**
  - [ ] æ‰€æœ‰APIç«¯ç‚¹åƒä¹‹å‰ä¸€æ ·å·¥ä½œ
  - [ ] è®¤è¯å·¥ä½œï¼ˆåŸºäºCookieï¼‰
  - [ ] WebSocketç»ˆç«¯å·¥ä½œ
  - [ ] ç«¯å£è½¬å‘å·¥ä½œ

- [ ] **å¼€å‘æ¨¡å¼**
  - [ ] ç‹¬ç«‹å¼€å‘æ¨¡å¼ä»ç„¶å·¥ä½œ
  - [ ] Vite HMRä»ç„¶åŠŸèƒ½æ­£å¸¸
  - [ ] APIä»£ç†é…ç½®å·¥ä½œ

### æ€§èƒ½è¦æ±‚

- [ ] **äºŒè¿›åˆ¶æ–‡ä»¶å¤§å°**: â‰¤ 25MBï¼ˆæœªå‹ç¼©ï¼‰
- [ ] **å¯åŠ¨æ—¶é—´**: â‰¤ 2ç§’
- [ ] **åˆå§‹é¡µé¢åŠ è½½**: â‰¤ 1ç§’
- [ ] **å†…å­˜ä½¿ç”¨**: â‰¤ 50MBï¼ˆç©ºé—²ï¼‰
- [ ] **å‰ç«¯èµ„æº**: ~250KBï¼ˆgzippedï¼‰

### è´¨é‡è¦æ±‚

- [ ] **æ— å›å½’**
  - [ ] æ‰€æœ‰ç°æœ‰åŠŸèƒ½å·¥ä½œ
  - [ ] æ‰€æœ‰æµ‹è¯•é€šè¿‡
  - [ ] æ— æ–°çš„æ§åˆ¶å°é”™è¯¯

- [ ] **è·¨å¹³å°**
  - [ ] åœ¨Windowsã€Linuxã€macOSä¸Šæ„å»º
  - [ ] åœ¨æ‰€æœ‰å¹³å°ä¸Šå·¥ä½œ

- [ ] **æ–‡æ¡£**
  - [ ] æ„å»ºè¿‡ç¨‹å·²è®°å½•
  - [ ] å¼€å‘å·¥ä½œæµå·²è®°å½•
  - [ ] éƒ¨ç½²æŒ‡å—å·²æ›´æ–°

---

## æµ‹è¯•æ¸…å•

### æ‰‹åŠ¨æµ‹è¯•

#### 1. æ„å»ºæµç¨‹
- [ ] å‰ç«¯æ„å»ºæˆåŠŸ
- [ ] åç«¯æ„å»ºæˆåŠŸ
- [ ] äºŒè¿›åˆ¶æ–‡ä»¶æˆåŠŸåˆ›å»º
- [ ] äºŒè¿›åˆ¶æ–‡ä»¶å¤§å°åˆç† (<25MB)

#### 2. æœåŠ¡å™¨å¯åŠ¨
- [ ] æœåŠ¡å™¨å¯åŠ¨æ— é”™è¯¯
- [ ] ä½¿ç”¨æ­£ç¡®ç«¯å£ (3000)
- [ ] ç¯å¢ƒå˜é‡å·²åŠ è½½
- [ ] æ—¥å¿—æ˜¾ç¤ºæ­£ç¡®çš„å¯åŠ¨åºåˆ—

#### 3. é™æ€èµ„æº
- [ ] `http://localhost:3000/` åŠ è½½
- [ ] ç™»å½•é¡µé¢æ­£ç¡®æ¸²æŸ“
- [ ] CSSæ ·å¼å·²åº”ç”¨
- [ ] å›¾ç‰‡åŠ è½½ï¼ˆå¦‚æœ‰ï¼‰
- [ ] æ§åˆ¶å°æ— 404é”™è¯¯

#### 4. è®¤è¯
- [ ] å¯ä»¥ä½¿ç”¨æœ‰æ•ˆtokenç™»å½•
- [ ] æ— æ•ˆtokenæ˜¾ç¤ºé”™è¯¯
- [ ] Cookieæ­£ç¡®è®¾ç½®
- [ ] ç™»å½•åé‡å®šå‘å·¥ä½œ

#### 5. å·¥ä½œç©ºé—´
- [ ] å·¥ä½œç©ºé—´åˆ—è¡¨é¡µåŠ è½½
- [ ] å¯ä»¥åˆ›å»ºå·¥ä½œç©ºé—´
- [ ] å¯ä»¥æŸ¥çœ‹å·¥ä½œç©ºé—´è¯¦æƒ…
- [ ] å¯ä»¥æ›´æ–°ç«¯å£
- [ ] å¯ä»¥é‡ç½®å·¥ä½œç©ºé—´
- [ ] å¯ä»¥åˆ é™¤å·¥ä½œç©ºé—´
- [ ] çŠ¶æ€æ­£ç¡®æ›´æ–°

#### 6. ç»ˆç«¯
- [ ] ç»ˆç«¯æ ‡ç­¾æ‰“å¼€
- [ ] WebSocketè¿æ¥
- [ ] å¯ä»¥è¾“å…¥å‘½ä»¤
- [ ] è¾“å‡ºæ­£ç¡®æ˜¾ç¤º
- [ ] è°ƒæ•´å¤§å°å·¥ä½œ
- [ ] é‡è¿å·¥ä½œ

#### 7. ç«¯å£è½¬å‘
- [ ] å¯ä»¥é€šè¿‡ `/forward/` è®¿é—®ç«¯å£
- [ ] è®¤è¯å·¥ä½œ
- [ ] è¯·æ±‚å¤´æ­£ç¡®è½¬å‘
- [ ] å“åº”æ­£ç¡®è¿”å›

#### 8. SPAè·¯ç”±
- [ ] æ‰€æœ‰è·¯ç”±æ­£ç¡®åŠ è½½
- [ ] ç›´æ¥URLè®¿é—®å·¥ä½œ
- [ ] æµè§ˆå™¨åˆ·æ–°å·¥ä½œ
- [ ] åé€€/å‰è¿›æŒ‰é’®å·¥ä½œ
- [ ] æ— 404é”™è¯¯

---

## å›æ»šè®¡åˆ’

å¦‚æœPhase 2.5é›†æˆå¤±è´¥æˆ–å¯¼è‡´é—®é¢˜ï¼Œè¯·éµå¾ªæ­¤å›æ»šç¨‹åº:

### ç«‹å³å›æ»šæ­¥éª¤

1. **æ¢å¤è·¯ç”±å™¨å˜æ›´**
   ```bash
   git checkout HEAD -- internal/api/router.go
   ```

2. **åˆ é™¤staticåŒ…**
   ```bash
   rm -rf internal/static/
   ```

3. **é‡å»ºåç«¯**
   ```bash
   go build -o vibox ./cmd/server
   ```

4. **è¿”å›åŒè¿›ç¨‹æ¨¡å¼**
   ```bash
   # ç»ˆç«¯1: åç«¯
   go run ./cmd/server

   # ç»ˆç«¯2: å‰ç«¯
   cd frontend && npm run dev
   ```

### å›æ»šåéªŒè¯

- [ ] åç«¯æˆåŠŸå¯åŠ¨
- [ ] å‰ç«¯å¼€å‘æœåŠ¡å™¨å¯åŠ¨
- [ ] å¯ä»¥é€šè¿‡ http://localhost:5173 è®¿é—®
- [ ] æ‰€æœ‰åŠŸèƒ½åƒä¹‹å‰ä¸€æ ·å·¥ä½œ

---

## æ—¶é—´çº¿

| å¤© | ä»»åŠ¡ | æ—¶é•¿ |
|-----|------|----------|
| **ç¬¬1å¤©ä¸Šåˆ** | æ¨¡å—1: å‰ç«¯æ„å»ºéªŒè¯ | 30åˆ†é’Ÿ |
| **ç¬¬1å¤©ä¸Šåˆ** | æ¨¡å—2: é™æ€æ–‡ä»¶åµŒå…¥ | 30åˆ†é’Ÿ |
| **ç¬¬1å¤©ä¸‹åˆ** | æ¨¡å—3: è·¯ç”±å™¨æ›´æ–° | 1å°æ—¶ |
| **ç¬¬1å¤©ä¸‹åˆ** | æ¨¡å—4: æ„å»ºå’Œæµ‹è¯•ï¼ˆç¬¬1éƒ¨åˆ†ï¼‰ | 1å°æ—¶ |
| **ç¬¬2å¤©ä¸Šåˆ** | æ¨¡å—4: é›†æˆæµ‹è¯• | 1-2å°æ—¶ |
| **ç¬¬2å¤©ä¸‹åˆ** | æ–‡æ¡£å’Œæ¸…ç† | 1å°æ—¶ |

**æ€»é¢„è®¡æ—¶é—´**: 1-2å¤©

---

## æˆåŠŸæŒ‡æ ‡

å½“æ»¡è¶³ä»¥ä¸‹æ¡ä»¶æ—¶ï¼ŒPhase 2.5æˆåŠŸ:

1. âœ… å•ä¸€äºŒè¿›åˆ¶æ–‡ä»¶ (`vibox`) è¿è¡Œå¹¶æä¾›å®Œæ•´åº”ç”¨
2. âœ… æ‰€æœ‰åŠŸèƒ½ä¸å¼€å‘æ¨¡å¼å®Œå…¨ç›¸åŒ
3. âœ… æ— å›å½’æˆ–å¼•å…¥çš„bug
4. âœ… æ€§èƒ½è¾¾åˆ°æˆ–è¶…è¿‡ç›®æ ‡
5. âœ… å¼€å‘å·¥ä½œæµä¿æŒé«˜æ•ˆ
6. âœ… æ–‡æ¡£å®Œæ•´å‡†ç¡®
7. âœ… å›¢é˜Ÿå¯ä»¥è‡ªä¿¡åœ°éƒ¨ç½²

---

## ä¸‹ä¸€æ­¥

Phase 2.5å®Œæˆå:

1. **æ›´æ–°æ–‡æ¡£**
   - ä½¿ç”¨å•äºŒè¿›åˆ¶éƒ¨ç½²æ›´æ–°README.md
   - ä½¿ç”¨æ–°æ„å»ºæµç¨‹æ›´æ–°DEPLOYMENT.md
   - ä½¿ç”¨æ–°å·¥ä½œæµæ›´æ–°CONTRIBUTING.md

2. **Dockeré›†æˆ**
   - æ›´æ–°Dockerfileä½¿ç”¨å¤šé˜¶æ®µæ„å»º
   - æ„å»ºå‰ç«¯ â†’ å¤åˆ¶åˆ°static â†’ æ„å»ºGo
   - æµ‹è¯•Dockeréƒ¨ç½²

3. **CI/CDæµæ°´çº¿**
   - æ·»åŠ è‡ªåŠ¨æ„å»ºæ­¥éª¤
   - æ·»åŠ è‡ªåŠ¨æµ‹è¯•
   - æ·»åŠ å‘å¸ƒå·¥ä»¶

4. **Phase 3è§„åˆ’**
   - å®¡æŸ¥è·¯çº¿å›¾
   - è§„åˆ’ä¸‹ä¸€ä¸ªåŠŸèƒ½
   - å®‰æ’å¯åŠ¨ä¼šè®®

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¥æœŸ**: 2025-11-11
**çŠ¶æ€**: æ´»è·ƒ
**è´Ÿè´£äºº**: ViBoxå›¢é˜Ÿ
