# ViBox - Docker 工作空间系统需求文档

## 1. 部署方式

- 使用 Docker 方式部署整个系统

## 2. 前端系统

### 2.1 基本功能
- 提供一个前端界面
- 暴露一个 Web 端口供用户访问

### 2.2 配置管理
支持以下配置项的管理：

#### 2.2.1 GitHub 配置
- 使用 Token 的方式进行认证

#### 2.2.2 AI Coding Agent 配置
- 支持配置文件管理
- 同一个 Coding Agent 可以有多个不同的配置

#### 2.2.3 开发环境脚本配置
- 针对不同开发环境的 `.sh` 文件
- 可以在创建工作空间时附加到创建过程
- 这些文件可以相互调用
- 在创建工作空间时全部复制到容器
- 可配置运行哪些 `.sh` 以及执行顺序

#### 2.2.4 VS Code 配置
- VS Code 服务器的配置
- VS Code 插件管理

## 3. 工作空间创建

### 3.1 创建流程
1. 用户选择 GitHub repo
2. 选择需要的 AI Coding Agent
3. 选择需要的开发环境配置

### 3.2 容器自动配置
创建工作空间时自动启动一个 Docker 容器，包含：

- **Ubuntu 环境**：基础操作系统
- **Git**：使用 GitHub 配置配置好的 Git 环境
- **VS Code 网页版服务器**：code-server
- **自动拉取仓库**：拉取选择的 GitHub 仓库
- **部署 AI Coding Agent**：部署选定的 Agent 和其配置（一种 Coding Agent 此时只能选择一个配置）
- **执行环境配置命令**：执行创建时设置的命令（用于安装开发环境）
- **VS Code 配置和插件**：应用配置的 VS Code 设置和插件

## 4. 工作空间使用

### 4.1 基本功能
- 用户通过前端进入 VS Code 环境
- 提供干净的开发环境
- 支持随时销毁和重建环境
- 通过 Git 去保存开发进度

## 5. 端口映射功能

### 5.1 端口转发机制
- 前端处理容器内 HTTP 服务端口的映射
- 用户可选择将容器内端口暴露为 URL

### 5.2 使用示例
- 容器内有一个 HTTP 服务运行在 8080 端口
- 用户可以选择在前端页面开启 8080 的端口映射
- 用户访问前端给出的 URL
- URL 格式：`baseurl/forward/workspace-name-port`
- 即可访问容器内的对应服务

## 技术架构概览

### 系统组成
```
┌─────────────────────────────────────────┐
│           前端 Web 界面                  │
│  - 配置管理                              │
│  - 工作空间管理                          │
│  - 端口映射控制                          │
└─────────────────────────────────────────┘
                   │
                   ▼
┌─────────────────────────────────────────┐
│         后端服务 (Docker 部署)           │
│  - 容器编排                              │
│  - 端口转发代理                          │
│  - 配置管理                              │
└─────────────────────────────────────────┘
                   │
                   ▼
┌─────────────────────────────────────────┐
│      工作空间容器 (动态创建)             │
│  - Ubuntu 环境                           │
│  - Git + GitHub 配置                     │
│  - VS Code Server                        │
│  - AI Coding Agent                       │
│  - 开发环境                              │
└─────────────────────────────────────────┘
```

## 下一步计划

1. 技术栈选型
2. 系统架构设计
3. 数据库设计（存储配置信息）
4. API 设计
5. 前端界面设计
6. 后端服务实现
7. 容器编排实现
8. 端口映射实现
