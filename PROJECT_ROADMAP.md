# ViBox 项目路线图

## 项目概述

ViBox 是一个基于 Docker 的工作空间管理系统，提供 Web 界面来创建、管理和访问开发环境容器。

**核心价值**：
- 通过浏览器访问隔离的开发环境
- 支持自定义环境配置脚本
- 提供 Web 终端和端口转发功能
- 一键创建和销毁工作空间

---

## 开发阶段规划

### 第一阶段：Go 后端核心功能 ✅ 已完成

**目标**：实现完整的 Go 后端服务，提供所有核心 API

**技术栈**：
- 语言：Go 1.25+
- Web 框架：Gin
- Docker SDK：github.com/docker/docker/client
- WebSocket：github.com/gorilla/websocket
- 反向代理：net/http/httputil（标准库）

**核心功能**：
1. Docker 容器管理 API（创建、启动、停止、删除、重置）
2. 容器内脚本执行
3. WebSocket 终端（WebSSH）
4. HTTP 端口转发（反向代理 + 端口标签）
5. 工作空间状态管理
6. 数据持久化（工作空间配置自动恢复）

**交付物**：
- 完整的 Go 后端服务
- RESTful API
- WebSocket 终端服务
- 反向代理功能
- Docker Compose 部署配置

**预计时间**：15-21 天（3-4 周）

**详细计划**：参见 [第一阶段后端实现文档](./docs/PHASE1_BACKEND.md)

---

### 第二阶段：前端界面 + MVP 集成 ✅ 已完成

**目标**：实现前端界面，完成 MVP（最小可行产品）

**前端技术栈**：
- **框架**：React 18.3+ (函数组件 + Hooks)
- **构建工具**：Vite 7.2+
- **语言**：TypeScript 5.9+
- **样式**：Tailwind CSS 4.1+ (utility-first)
- **UI 组件**：shadcn UI (基于 Radix UI)
- **状态管理**：Jotai 2.15+ (原子化状态)
- **路由**：React Router DOM 7.9+
- **HTTP 客户端**：Axios 1.13+
- **终端**：xterm.js 5.5+ (WebGL 渲染)
- **通知**：Sonner 2.0+ (Toast 通知)
- **图标**：Lucide React

**核心功能**：
1. **用户认证界面**
   - Token 登录页面
   - Cookie 会话管理
   - 受保护路由

2. **工作空间管理界面**
   - 创建工作空间表单（名称、镜像、脚本、端口标签）
   - 工作空间列表（实时状态更新）
   - 删除/重置工作空间
   - Skeleton 加载状态

3. **Web 终端集成**
   - xterm.js + WebSocket 集成
   - 全屏模式支持
   - 终端窗口自适应
   - 自动重连机制

4. **端口管理界面**
   - 端口标签快捷访问
   - 动态端口访问（任意端口）
   - 端口标签增删改
   - 新窗口打开服务

5. **设置与错误处理**
   - 设置页面（登出、版本信息）
   - 全局错误边界
   - Toast 通知系统
   - 响应式设计

**MVP 完整流程**：
```
用户操作：
1. 浏览器访问前端页面
2. Token 登录 → 设置 Cookie 会话
3. 查看工作空间列表（实时状态更新）
4. 点击"创建工作空间"
5. 配置名称、镜像、初始化脚本、端口标签
6. 点击"创建" → 后端创建容器并执行脚本
7. 状态自动更新：creating → running/error
8. 点击"Terminal" → 打开 Web 终端（xterm.js）
9. 通过终端访问容器 Shell，执行命令
10. 点击端口标签快捷按钮 → 新窗口访问容器内 HTTP 服务
11. 管理端口标签（添加/编辑/删除）
12. 重置工作空间（重新执行脚本）
13. 删除工作空间 → 删除容器
```

**部署架构**：
```
用户浏览器
    ↓
Caddy (domain.com)
    ↓
反向代理到 localhost:3000
    ↓
Go 后端服务（唯一对外端口）
    ├── /           → 前端静态文件
    ├── /api/*      → RESTful API
    ├── /ws/*       → WebSocket 终端
    └── /forward/*  → 容器端口转发
```

**交付物**：
- ✅ 前端应用（React + TypeScript + Vite）
- ✅ 完整的用户工作流程
- ✅ 8个模块化开发完成（Foundation, State, API, Auth UI, Workspace UI, Terminal, Polish, Optimization）
- ✅ 生产构建优化（代码分割、vendor chunking）
- ✅ 用户文档（README、开发指南、故障排除）

**开发时间**：12 天（2025-10-30 至 2025-11-11）

**详细计划**：参见 [第二阶段前端实现文档](./docs/PHASE2_FRONTEND.md)

**注意**: Phase 2 完成后前后端仍为分离状态，需要 Phase 2.5 进行集成。

---

### 第2.5阶段：前后端集成 🔄 进行中

**目标**：将 React 前端嵌入到 Go 后端，实现单一可执行文件部署

**为什么需要 Phase 2.5**:
- Phase 1 和 Phase 2 完成后，前后端为独立运行的两个进程
- 部署和使用需要单独启动前端和后端
- Phase 2.5 将它们集成为一个整体应用

**核心任务**：
1. **前端构建** - 生成生产优化的静态文件
2. **Go embed 集成** - 使用 Go 1.16+ embed 特性嵌入前端资源
3. **路由器更新** - 添加静态文件服务和 SPA fallback
4. **完整测试** - 验证单一可执行文件的所有功能
5. **文档更新** - 更新部署指南和开发流程

**技术方案**：
- 使用 Go `embed` 包嵌入 `frontend/dist` 目录
- Gin 路由器提供静态文件服务
- SPA fallback: 未匹配路由返回 `index.html`
- 保持 API、WebSocket、端口转发路由优先级

**交付物**：
- ⏳ 单一可执行文件（vibox.exe / vibox）
- ⏳ 嵌入的前端静态资源（~250KB gzipped）
- ⏳ 更新的部署文档
- ⏳ 跨平台构建支持（Windows/Linux/macOS）

**预计时间**：1-2 天

**详细计划**：参见 [第2.5阶段集成文档](./docs/PHASE2.5_INTEGRATION.md)

---

### 第三阶段：完整功能扩展 ⏳ 待定

**目标**：实现完整的系统需求

**待实现功能**：

#### 1. GitHub 集成
- GitHub Token 配置管理
- 自动拉取指定仓库到工作空间
- Git 配置自动化

#### 2. AI Coding Agent 集成
- AI Agent 配置管理（支持多个配置）
- 在工作空间中部署 AI Coding Agent
- Agent 与开发环境集成

#### 3. VS Code Server 集成
- 工作空间内自动部署 code-server
- VS Code 配置和插件管理
- 通过浏览器访问 VS Code

#### 4. 高级配置管理
- 可视化配置界面
- 配置模板功能
- 导入/导出配置

#### 5. 用户管理与权限
- 用户认证
- 工作空间权限管理
- 多租户支持

#### 6. 数据持久化
- 工作空间数据持久化存储
- 配置数据库（PostgreSQL/MySQL）
- 备份与恢复

#### 7. 监控与日志
- 工作空间资源监控
- 操作日志审计
- 性能指标收集

**交付物**：
- 完整的生产级系统
- 管理文档
- 运维手册

**预计时间**：待定（需根据实际需求评估）

---

## 技术架构演进

### 第一阶段架构
```
┌─────────────────────────────────────┐
│  Go 后端服务 (:3000)                 │
│  ├── RESTful API                    │
│  ├── WebSocket 终端                 │
│  ├── 反向代理                       │
│  └── Docker SDK                     │
└──────────────┬──────────────────────┘
               │
        Docker Engine
        └── 工作空间容器
```

### 第二阶段架构
```
┌────────────────────────────────────────┐
│  前端 (React/Vue)                      │
└───────────────┬────────────────────────┘
                │
┌───────────────▼────────────────────────┐
│  Go 后端服务 (:3000)                    │
│  ├── 静态文件服务 (前端)                │
│  ├── RESTful API                       │
│  ├── WebSocket 终端                    │
│  └── 反向代理                          │
└───────────────┬────────────────────────┘
                │
        Docker Engine
        └── 工作空间容器
```

### 第三阶段架构（可能）
```
┌────────────────────────────────────────┐
│  前端 + 管理界面                        │
└───────────────┬────────────────────────┘
                │
┌───────────────▼────────────────────────┐
│  Go 后端服务                            │
│  ├── 认证/授权                         │
│  ├── 业务逻辑                          │
│  └── 外部集成 (GitHub, AI Agent)      │
└───────────────┬────────────────────────┘
                │
        ┌───────┴────────┐
        │                │
    Database      Docker Engine
                  ├── 工作空间容器
                  ├── Code Server 容器
                  └── AI Agent 容器
```

---

## 当前状态

### 已完成 ✅

**第一阶段：Go 后端核心功能**
- ✅ Docker 容器管理 API（创建、启动、停止、删除、重置）
- ✅ 容器内脚本执行
- ✅ WebSocket 终端（WebSSH）
- ✅ HTTP 端口转发（动态访问 + 端口标签）
- ✅ 工作空间状态管理
- ✅ 数据持久化（配置自动恢复）
- ✅ Cookie 鉴权系统
- ✅ Docker Compose 部署配置

**第二阶段：前端界面 + MVP 集成**
- ✅ React 前端框架（Vite + TypeScript）
- ✅ 用户认证界面（Token 登录）
- ✅ 工作空间管理界面（创建、删除、重置）
- ✅ Web 终端集成（xterm.js + WebSocket）
- ✅ 端口管理界面（标签、快捷访问）
- ✅ 响应式设计（桌面、平板、移动）
- ✅ 错误处理与通知系统
- ✅ 性能优化（代码分割、bundle 优化）
- ✅ 完整文档（API、开发指南、故障排除）

### 进行中 🔄
- 🔄 **Phase 2.5**：前后端集成（静态文件嵌入）

### 待定 ⏳
- ⏳ 第三阶段：完整功能扩展（GitHub 集成、AI Agent、VS Code Server 等）

---

## 成功标准

### 第一阶段成功标准
- [x] 文档完成
- [ ] Go 后端服务可启动
- [ ] 可通过 API 创建/删除工作空间
- [ ] WebSocket 终端可正常使用
- [ ] 端口转发功能正常
- [ ] Docker Compose 部署成功

### 第二阶段成功标准（待定）
- [ ] 前端界面美观易用
- [ ] 完整工作流程可用
- [ ] 用户可独立完成所有操作
- [ ] 部署简单（一键启动）

### 第三阶段成功标准（待定）
- [ ] 所有扩展功能实现
- [ ] 生产环境可用
- [ ] 性能满足要求
- [ ] 文档完整

---

## 风险与约束

### 技术风险
1. **Docker Socket 安全**：后端需要访问 Docker socket，有安全风险
   - 缓解：限制容器权限，考虑使用 Docker API over TCP

2. **WebSocket 稳定性**：多并发会话可能影响性能
   - 缓解：限制会话数，实现超时机制

3. **资源管理**：容器可能耗尽系统资源
   - 缓解：设置资源限制，实现自动清理

### 时间约束
- 第一阶段：15-21 天（专注后端）
- 后续阶段：根据实际情况调整

### 技能约束
- Go 语言学习曲线（开发者正在学习）
- 前端技术栈待定

---

## 参考文档

### 第一阶段文档
- [第一阶段后端实现](./docs/PHASE1_BACKEND.md) - 详细开发计划和架构设计
- [任务拆分方案](./docs/PHASE1_TASK_BREAKDOWN.md) - 模块化开发和并行任务分配
- [API 规范](./docs/API_SPECIFICATION.md) - RESTful API 和 WebSocket 接口定义

### 技术参考
- [Go 官方文档](https://go.dev/doc/)
- [Docker SDK for Go](https://docs.docker.com/engine/api/sdk/)
- [Gin Web 框架](https://gin-gonic.com/)
- [gorilla/websocket](https://github.com/gorilla/websocket)

---

## 版本历史

- **v0.2** (2025-11-10): 完成任务拆分和 API 规范文档
- **v0.1** (2025-11-10): 项目启动，完成第一阶段规划
- 后续版本根据开发进度更新
