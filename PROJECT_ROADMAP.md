# ViBox 项目路线图

## 项目概述

ViBox 是一个基于 Docker 的工作空间管理系统，提供 Web 界面来创建、管理和访问开发环境容器。

**核心价值**：
- 通过浏览器访问隔离的开发环境
- 支持自定义环境配置脚本
- 提供 Web 终端和端口转发功能
- 一键创建和销毁工作空间

---

## 开发阶段规划

### 第一阶段：Go 后端核心功能 ✅ 当前阶段

**目标**：实现完整的 Go 后端服务，提供所有核心 API

**技术栈**：
- 语言：Go 1.21+
- Web 框架：Gin
- Docker SDK：github.com/docker/docker/client
- WebSocket：github.com/gorilla/websocket
- 反向代理：net/http/httputil（标准库）

**核心功能**：
1. Docker 容器管理 API（创建、启动、停止、删除）
2. 容器内脚本执行
3. WebSocket 终端（WebSSH）
4. HTTP 端口转发（反向代理）
5. 工作空间状态管理

**交付物**：
- 完整的 Go 后端服务
- RESTful API
- WebSocket 终端服务
- 反向代理功能
- Docker Compose 部署配置

**预计时间**：15-21 天（3-4 周）

**详细计划**：参见 [第一阶段后端实现文档](./docs/PHASE1_BACKEND.md)

---

### 第二阶段：前端界面 + MVP 集成 ⏳ 待定

**目标**：实现前端界面，完成 MVP（最小可行产品）

**前端技术栈（待定）**：

**选项 1**：React + TypeScript
```
框架：React 18
构建工具：Vite
终端：xterm.js
UI 库：Ant Design / Tailwind CSS（待定）
```

**选项 2**：Vue + TypeScript
```
框架：Vue 3
构建工具：Vite
终端：xterm.js
UI 库：Element Plus / Naive UI（待定）
```

**选项 3**：原生 HTML + JavaScript
```
更简单，但功能可能受限
```

**核心功能**：
1. **工作空间管理界面**
   - 创建工作空间表单
   - 工作空间列表
   - 删除工作空间

2. **脚本管理**
   - 脚本上传/编辑
   - 脚本执行顺序配置

3. **Web 终端集成**
   - xterm.js 集成
   - WebSocket 连接
   - 终端窗口大小调整

4. **端口转发管理**
   - 端口启用/禁用界面
   - 生成访问 URL
   - 端口状态显示

**MVP 完整流程**：
```
用户操作：
1. 打开前端页面
2. 点击"创建工作空间"
3. （可选）上传/配置初始化脚本
4. 点击"创建" → 后端创建容器并执行脚本
5. 打开 Web 终端 → 通过浏览器访问容器 Shell
6. 启用端口转发 → 访问容器内 HTTP 服务
7. 销毁工作空间 → 删除容器
```

**部署架构**：
```
用户浏览器
    ↓
Caddy (domain.com)
    ↓
反向代理到 localhost:3000
    ↓
Go 后端服务（唯一对外端口）
    ├── /           → 前端静态文件
    ├── /api/*      → RESTful API
    ├── /ws/*       → WebSocket 终端
    └── /forward/*  → 容器端口转发
```

**交付物**：
- 前端应用（打包后嵌入 Go 后端）
- 完整的工作流程
- 用户文档

**预计时间**：待定（取决于前端技术选型和复杂度）

---

### 第三阶段：完整功能扩展 ⏳ 待定

**目标**：实现完整的系统需求

**待实现功能**：

#### 1. GitHub 集成
- GitHub Token 配置管理
- 自动拉取指定仓库到工作空间
- Git 配置自动化

#### 2. AI Coding Agent 集成
- AI Agent 配置管理（支持多个配置）
- 在工作空间中部署 AI Coding Agent
- Agent 与开发环境集成

#### 3. VS Code Server 集成
- 工作空间内自动部署 code-server
- VS Code 配置和插件管理
- 通过浏览器访问 VS Code

#### 4. 高级配置管理
- 可视化配置界面
- 配置模板功能
- 导入/导出配置

#### 5. 用户管理与权限
- 用户认证
- 工作空间权限管理
- 多租户支持

#### 6. 数据持久化
- 工作空间数据持久化存储
- 配置数据库（PostgreSQL/MySQL）
- 备份与恢复

#### 7. 监控与日志
- 工作空间资源监控
- 操作日志审计
- 性能指标收集

**交付物**：
- 完整的生产级系统
- 管理文档
- 运维手册

**预计时间**：待定（需根据实际需求评估）

---

## 技术架构演进

### 第一阶段架构
```
┌─────────────────────────────────────┐
│  Go 后端服务 (:3000)                 │
│  ├── RESTful API                    │
│  ├── WebSocket 终端                 │
│  ├── 反向代理                       │
│  └── Docker SDK                     │
└──────────────┬──────────────────────┘
               │
        Docker Engine
        └── 工作空间容器
```

### 第二阶段架构
```
┌────────────────────────────────────────┐
│  前端 (React/Vue)                      │
└───────────────┬────────────────────────┘
                │
┌───────────────▼────────────────────────┐
│  Go 后端服务 (:3000)                    │
│  ├── 静态文件服务 (前端)                │
│  ├── RESTful API                       │
│  ├── WebSocket 终端                    │
│  └── 反向代理                          │
└───────────────┬────────────────────────┘
                │
        Docker Engine
        └── 工作空间容器
```

### 第三阶段架构（可能）
```
┌────────────────────────────────────────┐
│  前端 + 管理界面                        │
└───────────────┬────────────────────────┘
                │
┌───────────────▼────────────────────────┐
│  Go 后端服务                            │
│  ├── 认证/授权                         │
│  ├── 业务逻辑                          │
│  └── 外部集成 (GitHub, AI Agent)      │
└───────────────┬────────────────────────┘
                │
        ┌───────┴────────┐
        │                │
    Database      Docker Engine
                  ├── 工作空间容器
                  ├── Code Server 容器
                  └── AI Agent 容器
```

---

## 当前状态

### 已完成
- ✅ 需求分析
- ✅ 技术选型（Go 后端）
- ✅ 架构设计
- ✅ 详细开发计划

### 进行中
- 🔄 第一阶段：Go 后端开发

### 待开始
- ⏳ 第二阶段：前端开发
- ⏳ 第三阶段：扩展功能

---

## 成功标准

### 第一阶段成功标准
- [x] 文档完成
- [ ] Go 后端服务可启动
- [ ] 可通过 API 创建/删除工作空间
- [ ] WebSocket 终端可正常使用
- [ ] 端口转发功能正常
- [ ] Docker Compose 部署成功

### 第二阶段成功标准（待定）
- [ ] 前端界面美观易用
- [ ] 完整工作流程可用
- [ ] 用户可独立完成所有操作
- [ ] 部署简单（一键启动）

### 第三阶段成功标准（待定）
- [ ] 所有扩展功能实现
- [ ] 生产环境可用
- [ ] 性能满足要求
- [ ] 文档完整

---

## 风险与约束

### 技术风险
1. **Docker Socket 安全**：后端需要访问 Docker socket，有安全风险
   - 缓解：限制容器权限，考虑使用 Docker API over TCP

2. **WebSocket 稳定性**：多并发会话可能影响性能
   - 缓解：限制会话数，实现超时机制

3. **资源管理**：容器可能耗尽系统资源
   - 缓解：设置资源限制，实现自动清理

### 时间约束
- 第一阶段：15-21 天（专注后端）
- 后续阶段：根据实际情况调整

### 技能约束
- Go 语言学习曲线（开发者正在学习）
- 前端技术栈待定

---

## 参考文档

### 第一阶段文档
- [第一阶段后端实现](./docs/PHASE1_BACKEND.md) - 详细开发计划和架构设计

### 技术参考
- [Go 官方文档](https://go.dev/doc/)
- [Docker SDK for Go](https://docs.docker.com/engine/api/sdk/)
- [Gin Web 框架](https://gin-gonic.com/)
- [gorilla/websocket](https://github.com/gorilla/websocket)

---

## 版本历史

- **v0.1** (2025-11-10): 项目启动，完成第一阶段规划
- 后续版本根据开发进度更新
